<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AECK Admin Panel - Qu·∫£n l√Ω k·∫øt qu·∫£ thi</title>
    <link rel="stylesheet" href="admin-style.css">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <div class="logo-section">
                <img src="assets/logo.png" alt="AECK Logo" class="admin-logo">
                <h1>üèõÔ∏è AECK Admin Panel</h1>
                <p>H·ªá th·ªëng qu·∫£n l√Ω k·∫øt qu·∫£ thi TSA 2026</p>
            </div>
            
            <!-- Firebase Status & Auth -->
            <div class="firebase-status">
                <div id="connectionStatus" class="status-indicator">
                    <span class="status-dot offline"></span>
                    <span>Connecting to Firebase...</span>
                </div>
                <div id="authSection">
                    <div id="loginForm" class="auth-form">
                        <input type="email" id="adminEmail" placeholder="Admin Email" required>
                        <input type="password" id="adminPassword" placeholder="Password" required>
                        <button onclick="loginAdmin()" class="btn btn-primary">Login</button>
                    </div>
                    <div id="userInfo" class="user-info" style="display: none;">
                        <span id="userEmail"></span>
                        <button onclick="logoutAdmin()" class="btn btn-secondary">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <main class="admin-main">
            <!-- Exam Session Management -->
            <section class="session-management">
                <div class="section-header">
                    <h2>üéØ Qu·∫£n l√Ω ƒê·ª£t Thi</h2>
                    <div class="session-controls">
                        <button class="btn btn-success" onclick="showCreateSessionModal()">‚ûï T·∫°o ƒë·ª£t thi m·ªõi</button>
                        <button class="btn btn-info" onclick="refreshSessions()">üîÑ T·∫£i l·∫°i</button>
                        <button class="btn btn-warning" onclick="migrateToFirebase()" title="Migration d·ªØ li·ªáu t·ª´ localStorage l√™n Firebase">üî• Migrate to Firebase</button>
                    </div>
                </div>
                
                <div class="sessions-grid" id="sessionsGrid">
                    <!-- Sessions will be loaded here -->
                </div>
            </section>

            <!-- Upload Section -->
            <section class="upload-section">
                <div class="section-header">
                    <h2>üìä Upload K·∫øt Qu·∫£ Thi</h2>
                    <div class="upload-controls">
                        <select id="targetSession" class="session-select">
                            <option value="">Ch·ªçn ƒë·ª£t thi ƒë·ªÉ upload</option>
                        </select>
                        <div class="status-badge" id="statusBadge">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
                    </div>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <h3>K√©o th·∫£ file Excel v√†o ƒë√¢y</h3>
                    <p>ho·∫∑c click ƒë·ªÉ ch·ªçn file (.xlsx, .xls)</p>
                    <input type="file" id="excelFile" accept=".xlsx,.xls" hidden>
                    <button class="upload-btn" onclick="document.getElementById('excelFile').click()">
                        Ch·ªçn File Excel
                    </button>
                </div>

                <div class="file-info" id="fileInfo" style="display: none;">
                    <h4>üìÑ Th√¥ng tin file:</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="label">T√™n file:</span>
                            <span id="fileName">-</span>
                        </div>
                        <div class="info-item">
                            <span class="label">K√≠ch th∆∞·ªõc:</span>
                            <span id="fileSize">-</span>
                        </div>
                        <div class="info-item">
                            <span class="label">S·ªë d√≤ng:</span>
                            <span id="rowCount">-</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Tr·∫°ng th√°i:</span>
                            <span id="processStatus">ƒêang x·ª≠ l√Ω...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Preview Section -->
            <section class="preview-section" id="previewSection" style="display: none;">
                <div class="section-header">
                    <h2>üëÅÔ∏è Xem tr∆∞·ªõc d·ªØ li·ªáu</h2>
                    <div class="preview-controls">
                        <button class="btn btn-secondary" onclick="togglePreview()">Thu g·ªçn</button>
                        <button class="btn btn-primary" onclick="saveToSystem()" id="saveBtn">
                            üíæ L∆∞u v√†o h·ªá th·ªëng
                        </button>
                    </div>
                </div>
                
                <div class="data-stats" id="dataStats"></div>
                
                <div class="table-container">
                    <table class="data-table" id="dataTable">
                        <thead id="tableHeader"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Current Data Section -->
            <section class="current-data-section">
                <div class="section-header">
                    <h2>üíæ D·ªØ li·ªáu hi·ªán t·∫°i</h2>
                    <div class="data-controls">
                        <button class="btn btn-info" onclick="loadCurrentData()">üîÑ T·∫£i l·∫°i</button>
                        <button class="btn btn-warning" onclick="exportData()">üì§ Xu·∫•t d·ªØ li·ªáu</button>
                        <button class="btn btn-danger" onclick="clearData()">üóëÔ∏è X√≥a d·ªØ li·ªáu</button>
                    </div>
                </div>
                
                <div class="current-stats" id="currentStats">
                    <div class="stat-card">
                        <h3 id="totalRecords">0</h3>
                        <p>T·ªïng s·ªë b·∫£n ghi</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="lastUpdate">Ch∆∞a c√≥</h3>
                        <p>C·∫≠p nh·∫≠t l·∫ßn cu·ªëi</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="avgScore">0</h3>
                        <p>ƒêi·ªÉm trung b√¨nh</p>
                    </div>
                </div>
            </section>

            <!-- Test Lookup Section -->
            <section class="test-section">
                <div class="section-header">
                    <h2>üîç Test tra c·ª©u</h2>
                </div>
                
                <div class="test-lookup">
                    <div class="input-group">
                        <input type="email" id="testEmail" placeholder="Nh·∫≠p email ƒë·ªÉ test tra c·ª©u...">
                        <button class="btn btn-primary" onclick="testLookup()">Tra c·ª©u</button>
                    </div>
                    <div class="test-result" id="testResult"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>ƒêang x·ª≠ l√Ω...</p>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Create Session Modal -->
    <div class="modal-overlay" id="sessionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üéØ T·∫°o ƒê·ª£t Thi M·ªõi</h3>
                <button class="modal-close" onclick="closeSessionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="sessionForm">
                    <div class="form-group">
                        <label for="sessionCode">M√£ ƒë·ª£t thi *</label>
                        <input type="text" id="sessionCode" name="sessionCode" placeholder="vd: tsa-2026-dot-2" required>
                        <small>Ch·ªâ d√πng ch·ªØ th∆∞·ªùng, s·ªë v√† d·∫•u g·∫°ch ngang</small>
                    </div>
                    <div class="form-group">
                        <label for="sessionName">T√™n ƒë·ª£t thi *</label>
                        <input type="text" id="sessionName" name="sessionName" placeholder="vd: TSA 2026 - ƒê·ª£t 2" required>
                    </div>
                    <div class="form-group">
                        <label for="sessionDesc">M√¥ t·∫£</label>
                        <textarea id="sessionDesc" name="sessionDesc" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ ƒë·ª£t thi n√†y"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="examDate">Ng√†y thi</label>
                        <input type="date" id="examDate" name="examDate">
                    </div>
                    <div class="form-group">
                        <label for="examInfo">Th√¥ng tin b·ªï sung</label>
                        <textarea id="examInfo" name="examInfo" placeholder="Th√¥ng tin v·ªÅ l·ªá ph√≠, h√¨nh th·ª©c thi, v.v..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="sessionStatus">Tr·∫°ng th√°i</label>
                        <select id="sessionStatus" name="sessionStatus">
                            <option value="active">üü¢ Ho·∫°t ƒë·ªông</option>
                            <option value="inactive">üî¥ T·∫°m d·ª´ng</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="setAsDefault"> 
                            ƒê·∫∑t l√†m ƒë·ª£t thi m·∫∑c ƒë·ªãnh
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeSessionModal()">H·ªßy</button>
                <button type="button" class="btn btn-primary" onclick="createSession()">T·∫°o ƒë·ª£t thi</button>
            </div>
        </div>
    </div>

    <!-- Excel Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK (compat version) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Firebase Service -->
    <script src="firebase-service.js"></script>
    
    <!-- Admin Script -->
    <script src="admin.js"></script>
</body>
</html>